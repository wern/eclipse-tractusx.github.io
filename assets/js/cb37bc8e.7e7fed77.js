"use strict";(self.webpackChunkeclipse_tractusx_github_io=self.webpackChunkeclipse_tractusx_github_io||[]).push([[52039],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>m});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},p="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),p=c(n),u=i,m=p["".concat(l,".").concat(u)]||p[u]||h[u]||r;return n?a.createElement(m,o(o({ref:t},d),{},{components:n})):a.createElement(m,o({ref:t},d))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[p]="string"==typeof e?e:i,o[1]=s;for(var c=2;c<r;c++)o[c]=n[c];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},87396:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>p,frontMatter:()=>r,metadata:()=>s,toc:()=>c});var a=n(87462),i=(n(67294),n(3905));const r={},o="Release process of tractusx-edc",s={unversionedId:"kits/tractusx-edc/docs/development/decision-records/2023-02-09-release-process/README",id:"version-3.1.0/kits/tractusx-edc/docs/development/decision-records/2023-02-09-release-process/README",title:"Release process of tractusx-edc",description:"Decision",source:"@site/docs-kits_versioned_docs/version-3.1.0/kits/tractusx-edc/docs/development/decision-records/2023-02-09-release-process/README.md",sourceDirName:"kits/tractusx-edc/docs/development/decision-records/2023-02-09-release-process",slug:"/kits/tractusx-edc/docs/development/decision-records/2023-02-09-release-process/",permalink:"/docs-kits/3.1.0/kits/tractusx-edc/docs/development/decision-records/2023-02-09-release-process/",draft:!1,tags:[],version:"3.1.0",frontMatter:{}},l={},c=[{value:"Decision",id:"decision",level:2},{value:"Rationale",id:"rationale",level:2},{value:"Approach",id:"approach",level:2},{value:"Use EDC <code>SNAPSHOT</code> versions during development",id:"use-edc-snapshot-versions-during-development",level:3},{value:"Use release versions of EDC in releases",id:"use-release-versions-of-edc-in-releases",level:3},{value:"Changes to the branching model",id:"changes-to-the-branching-model",level:3},{value:"Further considerations",id:"further-considerations",level:2},{value:"A word on Bugfixes/Hotfixes",id:"a-word-on-bugfixeshotfixes",level:3},{value:"Nightly builds",id:"nightly-builds",level:3},{value:"Notes for becoming OpenSource",id:"notes-for-becoming-opensource",level:2}],d={toc:c};function p(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"release-process-of-tractusx-edc"},"Release process of tractusx-edc"),(0,i.kt)("h2",{id:"decision"},"Decision"),(0,i.kt)("p",null,"To improve stability, reproducibility and maintainability of releases, tractusx-edc will undergo the following changes:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"use EDC ",(0,i.kt)("inlineCode",{parentName:"li"},"SNAPSHOT")," builds during development"),(0,i.kt)("li",{parentName:"ul"},"use release versions of EDC in releases. Release branches must not change upstream dependency versions, unless there\nis a clear and concise reason to do so."),(0,i.kt)("li",{parentName:"ul"},"slightly update branching model"),(0,i.kt)("li",{parentName:"ul"},"if possible, bugs/defects should be fixed on ",(0,i.kt)("inlineCode",{parentName:"li"},"main")," and be backported to the respective ",(0,i.kt)("inlineCode",{parentName:"li"},"hotfix/")," branch"),(0,i.kt)("li",{parentName:"ul"},"only hotfixes for critical security bugs will be provided as defined by the committers for the\ncurrently released version. Nothing else."),(0,i.kt)("li",{parentName:"ul"},"feature development happens ",(0,i.kt)("em",{parentName:"li"},"in developers' forks only")," to keep the Git reflog of the ",(0,i.kt)("inlineCode",{parentName:"li"},"origin")," clean.")),(0,i.kt)("h2",{id:"rationale"},"Rationale"),(0,i.kt)("p",null,"Having releases depend on snapshot versions of upstream projects, such as EDC, is inherently dangerous, particularly\nwhen that dependency has not yet reached a final state and breaking changes are to be expected. Most problems will stem\nfrom breaking changes, such as Java SPIs, APIs and changes in service contracts."),(0,i.kt)("p",null,"Up until now, the only way out was cherry-picking, which is extremely cumbersome and error-prone, and requires a\nparallel build pipeline to publish the cherry-picked artifacts of EDC (and potentially others). With the approach\npresented here, cherry-picking is still an option, but there are easier alternatives to it."),(0,i.kt)("p",null,"Every release version published by tractusx-edc must be reproducible at any time."),(0,i.kt)("h2",{id:"approach"},"Approach"),(0,i.kt)("h3",{id:"use-edc-snapshot-versions-during-development"},"Use EDC ",(0,i.kt)("inlineCode",{parentName:"h3"},"SNAPSHOT")," versions during development"),(0,i.kt)("p",null,"During feature development we only use ",(0,i.kt)("inlineCode",{parentName:"p"},"-SNAPSHOT")," versions of EDC packages. It is assumed that when the build breaks\ndue to changes in upstream, the fix can be done quickly and easily, much more so than working off technical\ndebt that would otherwise accumulate over several months. Builds on ",(0,i.kt)("inlineCode",{parentName:"p"},"main")," are therefore ",(0,i.kt)("em",{parentName:"p"},"not repeatable"),", but that\ndownside is easily offset by the tighter alignment with and smaller technical debt and integration pain with the\nupstream EDC."),(0,i.kt)("h3",{id:"use-release-versions-of-edc-in-releases"},"Use release versions of EDC in releases"),(0,i.kt)("p",null,"First, a new branch ",(0,i.kt)("inlineCode",{parentName:"p"},"release/X.Y.Z")," based off of ",(0,i.kt)("inlineCode",{parentName:"p"},"main")," is created. This can either be done\non ",(0,i.kt)("inlineCode",{parentName:"p"},"HEAD"),", or - if desired - on a particular ref. The latter case is relevant if there are already features\nin ",(0,i.kt)("inlineCode",{parentName:"p"},"main")," that are not scoped for a particular release."),(0,i.kt)("p",null,"Second, the dependency onto EDC is updated to the most recent build. For example, if a release is\ncreated on March 27th 2023, the most recent nightly would be ",(0,i.kt)("inlineCode",{parentName:"p"},"0.0.1-20230326"),"."),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"Updating Gradle files or Maven POMs, creating branches and tags in Git should be automated through GitHub Actions as\npart of the release process. For reference"),":"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Modifying and committing files: ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/orgs/community/discussions/26842#discussioncomment-3253612"},"https://github.com/orgs/community/discussions/26842#discussioncomment-3253612")),(0,i.kt)("li",{parentName:"ul"},"Creating branches: ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/marketplace/actions/create-branch"},"https://github.com/marketplace/actions/create-branch")),(0,i.kt)("li",{parentName:"ul"},"Creating tags using GitHub's\nAPI: ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/eclipse-edc/Connector/blob/b24a5cacbc9fcabdfd8020d779399b3e56856661/.github/workflows/release-edc.yml#L21"},"https://github.com/eclipse-edc/Connector/blob/b24a5cacbc9fcabdfd8020d779399b3e56856661/.github/workflows/release-edc.yml#L21")," (\nexample)"),(0,i.kt)("li",{parentName:"ul"},"Create GitHub Release: ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/eclipse-edc/Connector/blob/b24a5cacbc9fcabdfd8020d779399b3e56856661/.github/workflows/release-edc.yml#L56"},"https://github.com/eclipse-edc/Connector/blob/b24a5cacbc9fcabdfd8020d779399b3e56856661/.github/workflows/release-edc.yml#L56")," (example)")),(0,i.kt)("p",null,"Once a release is created, the EDC upstream version must not change anymore, unless there is good reason to do so, for\nexample, a defect, that needs to be fixed upstream. At that point a decision can also be made to employ a cherry-pick model, in case the\nupstream's development has progressed to the point of breaking changes."),(0,i.kt)("h3",{id:"changes-to-the-branching-model"},"Changes to the branching model"),(0,i.kt)("p",null,"Tractusx-edc's branching model is already very close to\nthe ",(0,i.kt)("a",{parentName:"p",href:"https://www.atlassian.com/git/tutorials/comparing-workflows/gitflow-workflow#:~:text=What%20is%20Gitflow%3F,lived%20branches%20and%20larger%20commits"},"GitFlow branching model"),"\nwhich is good. The following changes need to be made:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"feature development happens in forks only. Thus, ",(0,i.kt)("inlineCode",{parentName:"li"},"feature/")," branches don't exist in the ",(0,i.kt)("inlineCode",{parentName:"li"},"origin"),". This is important\nwhen moving to OSS."),(0,i.kt)("li",{parentName:"ul"},"adhere to GitFlow branch naming conventions, i.e. no ",(0,i.kt)("inlineCode",{parentName:"li"},"docu"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"tryout_something")," branches. Increases readability and\nclarity, improves tool support.")),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"Other guidelines w.r.t. the review process, merging etc. will follow in a later DR.")),(0,i.kt)("h2",{id:"further-considerations"},"Further considerations"),(0,i.kt)("h3",{id:"a-word-on-bugfixeshotfixes"},"A word on Bugfixes/Hotfixes"),(0,i.kt)("p",null,"Once a release is published, for example ",(0,i.kt)("inlineCode",{parentName:"p"},"0.3.1")," it will receive no further development other than hotfixes. Similarly,\nhotfix branches are created based off of the release branch, here ",(0,i.kt)("inlineCode",{parentName:"p"},"releases/0.3.1"),", thus, ",(0,i.kt)("inlineCode",{parentName:"p"},"hotfix/0.3.1"),". From this,\nthree scenarios emerge:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"The actual fix is done on ",(0,i.kt)("inlineCode",{parentName:"li"},"main")," and can be cherry-picked into the ",(0,i.kt)("inlineCode",{parentName:"li"},"hotfix/0.3.1")," branch. No new commits are\nmade directly in that branch."),(0,i.kt)("li",{parentName:"ol"},"The actual fix is done on ",(0,i.kt)("inlineCode",{parentName:"li"},"main")," and must be manually ported into the ",(0,i.kt)("inlineCode",{parentName:"li"},"hotfix/0.3.1")," branch. One or several new\ncommits are made on ",(0,i.kt)("inlineCode",{parentName:"li"},"hotfix/0.3.1"),". This is needed when cherry-picking is not available due to incompatibilities\nbetween ",(0,i.kt)("inlineCode",{parentName:"li"},"main")," and the hotfix branch due to intermittent changes."),(0,i.kt)("li",{parentName:"ol"},"The fix is only relevant for the ",(0,i.kt)("inlineCode",{parentName:"li"},"0.3.1")," hotfix, it is not needed in ",(0,i.kt)("inlineCode",{parentName:"li"},"main"),". This can happen, when the problem is\nnot present on ",(0,i.kt)("inlineCode",{parentName:"li"},"main"),", because it was already implicitly fixed, or otherwise doesn't exist.")),(0,i.kt)("p",null,"This might produce many branches, and the first ",(0,i.kt)("inlineCode",{parentName:"p"},"hotfix")," makes the release obsolete, but it will greatly help\nreadability and make a release's history readily apparent."),(0,i.kt)("h3",{id:"nightly-builds"},"Nightly builds"),(0,i.kt)("p",null,"Nightly builds are generated according to a fixed schedule. Upstream EDC will soon begin to publish nightly\nbuilds as actual releases (as opposed to: snapshots) to a separate OSSRH-operated repository (see\n",(0,i.kt)("a",{parentName:"p",href:"https://github.com/eclipse-edc/Connector/tree/main/docs/developer/decision-records/2023-02-10-nightly-builds"},"this EDC decision record"),")."),(0,i.kt)("p",null,"Unfortunately there is no way to automatically trigger the tractusx-edc build whenever a new EDC nightly is\ncreated. The most reliable method is to periodically query for the latest EDC nightly, e.g. leveraging GitHub's\n",(0,i.kt)("inlineCode",{parentName:"p"},"dependabot")," feature, or using the following ",(0,i.kt)("inlineCode",{parentName:"p"},"curl")," command:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},'curl <OSSHR_RELEASES_REPO_URL>/org/eclipse/edc/connector-core/maven-metadata.xml | xmllint --xpath "//metadata/versioning/versions/version[last()]" -\n')),(0,i.kt)("p",null,"That would return something like to ",(0,i.kt)("inlineCode",{parentName:"p"},"0.0.1-20230213"),". As soon as the version string (here: Feb 13th, 2023) matches the\ncurrent date, we can start the nightly. If the EDC nightly doesn't appear within a set timeframe, we throw an error."),(0,i.kt)("h2",{id:"notes-for-becoming-opensource"},"Notes for becoming OpenSource"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"All artifacts (docker images, helm charts, Maven artifacts) should be published to well-known and publicly accessible\nlocations such as MavenCentral, DockerHub, etc. The GitHub Packages repository is only accessible to authenticated\nusers."),(0,i.kt)("li",{parentName:"ul"},"When the project was migrated to be an Eclipse project, we'll have to adopt the Eclipse Foundation's publishing guidelines,\nwhich prescribes the use of Jenkins for publishing to MavenCentral and OSSRH."),(0,i.kt)("li",{parentName:"ul"},"Typically, GitHub Actions should perform all verification tasks, running tests, etc. and Jenkins' only purpose is to\npublish.")))}p.isMDXComponent=!0}}]);