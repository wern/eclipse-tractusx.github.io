"use strict";(self.webpackChunkeclipse_tractusx_github_io=self.webpackChunkeclipse_tractusx_github_io||[]).push([[60994],{3905:(e,t,s)=>{s.d(t,{Zo:()=>p,kt:()=>h});var n=s(67294);function a(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function r(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,n)}return s}function o(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?r(Object(s),!0).forEach((function(t){a(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):r(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function l(e,t){if(null==e)return{};var s,n,a=function(e,t){if(null==e)return{};var s,n,a={},r=Object.keys(e);for(n=0;n<r.length;n++)s=r[n],t.indexOf(s)>=0||(a[s]=e[s]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)s=r[n],t.indexOf(s)>=0||Object.prototype.propertyIsEnumerable.call(e,s)&&(a[s]=e[s])}return a}var i=n.createContext({}),c=function(e){var t=n.useContext(i),s=t;return e&&(s="function"==typeof e?e(t):o(o({},t),e)),s},p=function(e){var t=c(e.components);return n.createElement(i.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var s=e.components,a=e.mdxType,r=e.originalType,i=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),u=c(s),m=a,h=u["".concat(i,".").concat(m)]||u[m]||d[m]||r;return s?n.createElement(h,o(o({ref:t},p),{},{components:s})):n.createElement(h,o({ref:t},p))}));function h(e,t){var s=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=s.length,o=new Array(r);o[0]=m;var l={};for(var i in t)hasOwnProperty.call(t,i)&&(l[i]=t[i]);l.originalType=e,l[u]="string"==typeof e?e:a,o[1]=l;for(var c=2;c<r;c++)o[c]=s[c];return n.createElement.apply(null,o)}return n.createElement.apply(null,s)}m.displayName="MDXCreateElement"},16198:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>i,contentTitle:()=>o,default:()=>u,frontMatter:()=>r,metadata:()=>l,toc:()=>c});var n=s(87462),a=(s(67294),s(3905));const r={},o="Run and debug Business-Tests local within IDE",l={unversionedId:"kits/tractusx-edc/docs/development/Run-business-tests-local",id:"version-3.1.0/kits/tractusx-edc/docs/development/Run-business-tests-local",title:"Run and debug Business-Tests local within IDE",description:"Prerequisites:",source:"@site/docs-kits_versioned_docs/version-3.1.0/kits/tractusx-edc/docs/development/Run-business-tests-local.md",sourceDirName:"kits/tractusx-edc/docs/development",slug:"/kits/tractusx-edc/docs/development/Run-business-tests-local",permalink:"/docs-kits/3.1.0/kits/tractusx-edc/docs/development/Run-business-tests-local",draft:!1,tags:[],version:"3.1.0",frontMatter:{}},i={},c=[{value:"1. Build all modules with maven and produce docker images",id:"1-build-all-modules-with-maven-and-produce-docker-images",level:2},{value:"2. Install the all-in-one supporting infrastructure environment (Daps, Vault, PostgreSql, Minio, Backend-Service)",id:"2-install-the-all-in-one-supporting-infrastructure-environment-daps-vault-postgresql-minio-backend-service",level:2},{value:"3. Install Plato as provider EDC",id:"3-install-plato-as-provider-edc",level:2},{value:"4. Install Socrates as consumer EDC",id:"4-install-socrates-as-consumer-edc",level:2},{value:"5. Set environment variables and run configuration in IDE",id:"5-set-environment-variables-and-run-configuration-in-ide",level:2},{value:"6. Update your components",id:"6-update-your-components",level:2},{value:"7. Tips",id:"7-tips",level:2}],p={toc:c};function u(e){let{components:t,...r}=e;return(0,a.kt)("wrapper",(0,n.Z)({},p,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"run-and-debug-business-tests-local-within-ide"},"Run and debug Business-Tests local within IDE"),(0,a.kt)("p",null,"Prerequisites:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"You need a local kubernetes cluster to install the services (Docker Desktop is recommended)."),(0,a.kt)("li",{parentName:"ul"},"You need kubectl and helm command line tools installed.")),(0,a.kt)("h2",{id:"1-build-all-modules-with-maven-and-produce-docker-images"},"1. Build all modules with maven and produce docker images"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"./gradlew dockerize\n")),(0,a.kt)("h2",{id:"2-install-the-all-in-one-supporting-infrastructure-environment-daps-vault-postgresql-minio-backend-service"},"2. Install the all-in-one supporting infrastructure environment (Daps, Vault, PostgreSql, Minio, Backend-Service)"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shel"},"helm install infrastructure edc-tests/src/main/resources/deployment/helm/supporting-infrastructure -n business-tests --dependency-update --create-namespace\n")),(0,a.kt)("p",null,"To access the PostgreSql databases you could use following kubectl port forwardings:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl port-forward plato-postgresql-0 -n business-tests 5555:5432\nkubectl port-forward sokrates-postgresql-0 -n business-tests 6666:5432\n")),(0,a.kt)("p",null,"Please use the same ports later for your environment variables."),(0,a.kt)("h2",{id:"3-install-plato-as-provider-edc"},"3. Install Plato as provider EDC"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"helm install plato charts/tractusx-connector -n business-tests --create-namespace \\\n  --set fullnameOverride=plato \\\n  --set controlplane.service.type=NodePort \\\n  --set controlplane.endpoints.data.authKey=password \\\n  --set controlplane.image.pullPolicy=Never \\\n  --set controlplane.image.tag=latest \\\n  --set controlplane.image.repository=edc-controlplane-postgresql-hashicorp-vault \\\n  --set dataplane.image.tag=latest \\\n  --set dataplane.image.pullPolicy=Never \\\n  --set dataplane.image.repository=edc-dataplane-hashicorp-vault \\\n  --set controlplane.debug.enabled=true \\\n  --set controlplane.suspendOnStart=false \\\n  --set postgresql.enabled=true \\\n  --set postgresql.username=user \\\n  --set postgresql.password=password \\\n  --set postgresql.jdbcUrl=jdbc:postgresql://plato-postgresql:5432/edc \\\n  --set vault.hashicorp.enabled=true \\\n  --set vault.hashicorp.url=http://vault:8200 \\\n  --set vault.hashicorp.token=root \\\n  --set vault.secretNames.transferProxyTokenSignerPublicKey=plato/daps/my-plato-daps-crt \\\n  --set vault.secretNames.transferProxyTokenSignerPrivateKey=plato/daps/my-plato-daps-key \\\n  --set vault.secretNames.transferProxyTokenEncryptionAesKey=plato/data-encryption-aes-keys \\\n  --set vault.secretNames.dapsPrivateKey=plato/daps/my-plato-daps-key \\\n  --set vault.secretNames.dapsPublicKey=plato/daps/my-plato-daps-crt \\\n  --set daps.url=http://ids-daps:4567 \\\n  --set daps.clientId=99:83:A7:17:86:FF:98:93:CE:A0:DD:A1:F1:36:FA:F6:0F:75:0A:23:keyid:99:83:A7:17:86:FF:98:93:CE:A0:DD:A1:F1:36:FA:F6:0F:75:0A:23 \\\n  --set dataplane.aws.endpointOverride=http://minio:9000 \\\n  --set dataplane.aws.secretAccessKey=platoqwerty123 \\\n  --set dataplane.aws.accessKeyId=platoqwerty123 \\\n  --set backendService.httpProxyTokenReceiverUrl=http://backend:8080 \\\n  --wait-for-jobs --timeout=120s\n")),(0,a.kt)("h2",{id:"4-install-socrates-as-consumer-edc"},"4. Install Socrates as consumer EDC"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"helm install sokrates charts/tractusx-connector -n business-tests --create-namespace \\\n  --set fullnameOverride=sokrates \\\n  --set controlplane.service.type=NodePort \\\n  --set controlplane.endpoints.data.authKey=password \\\n  --set controlplane.image.pullPolicy=Never \\\n  --set controlplane.image.tag=latest \\\n  --set controlplane.image.repository=edc-controlplane-postgresql-hashicorp-vault \\\n  --set dataplane.image.tag=latest \\\n  --set dataplane.image.pullPolicy=Never \\\n  --set dataplane.image.repository=edc-dataplane-hashicorp-vault \\\n  --set controlplane.debug.enabled=true \\\n  --set controlplane.suspendOnStart=false \\\n  --set postgresql.enabled=true \\\n  --set postgresql.username=user \\\n  --set postgresql.password=password \\\n  --set postgresql.jdbcUrl=jdbc:postgresql://sokrates-postgresql:5432/edc \\\n  --set vault.hashicorp.enabled=true \\\n  --set vault.hashicorp.url=http://vault:8200 \\\n  --set vault.hashicorp.token=root \\\n  --set vault.secretNames.transferProxyTokenSignerPublicKey=sokrates/daps/my-sokrates-daps-crt \\\n  --set vault.secretNames.transferProxyTokenSignerPrivateKey=sokrates/daps/my-sokrates-daps-key \\\n  --set vault.secretNames.transferProxyTokenEncryptionAesKey=sokrates/data-encryption-aes-keys \\\n  --set vault.secretNames.dapsPrivateKey=sokrates/daps/my-sokrates-daps-key \\\n  --set vault.secretNames.dapsPublicKey=sokrates/daps/my-sokrates-daps-crt \\\n  --set daps.url=http://ids-daps:4567 \\\n  --set daps.clientId=E7:07:2D:74:56:66:31:F0:7B:10:EA:B6:03:06:4C:23:7F:ED:A6:65:keyid:E7:07:2D:74:56:66:31:F0:7B:10:EA:B6:03:06:4C:23:7F:ED:A6:65 \\\n  --set dataplane.aws.endpointOverride=http://minio:9000 \\\n  --set dataplane.aws.secretAccessKey=sokratesqwerty123 \\\n  --set dataplane.aws.accessKeyId=sokratesqwerty123 \\\n  --set backendService.httpProxyTokenReceiverUrl=http://backend:8080 \\\n  --wait-for-jobs --timeout=120s\n")),(0,a.kt)("h2",{id:"5-set-environment-variables-and-run-configuration-in-ide"},"5. Set environment variables and run configuration in IDE"),(0,a.kt)("p",null,'You can create a run configuration in IntelliJ like bellow screenshot and copy/paste the whole set of environments variables if you use ";" after each line.'),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Example run config",src:s(34522).Z,width:"1557",height:"784"})),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"PLATO_BACKEND_SERVICE_BACKEND_API_URL=http://localhost:<PORT>;\nPLATO_DATA_MANAGEMENT_API_AUTH_KEY=password;\nPLATO_DATA_MANAGEMENT_URL=http://localhost:<PORT>/data;\nPLATO_DATA_PLANE_URL=foo;\nPLATO_DATABASE_PASSWORD=password;\nPLATO_DATABASE_URL=jdbc:postgresql://localhost:5555/edc;\nPLATO_DATABASE_USER=user;\nPLATO_IDS_URL=http://plato-controlplane:8084/api/v1/ids;\nPLATO_AWS_SECRET_ACCESS_KEY=platoqwerty123;\nPLATO_AWS_ACCESS_KEY_ID=platoqwerty123;\nSOKRATES_BACKEND_SERVICE_BACKEND_API_URL=http://localhost:<PORT>;\nSOKRATES_BACKEND_URL=http://localhost:<PORT>;\nSOKRATES_DATA_MANAGEMENT_API_AUTH_KEY=password;\nSOKRATES_DATA_MANAGEMENT_URL=http://localhost:<PORT>/data;\nSOKRATES_DATA_PLANE_URL=foo;\nSOKRATES_DATABASE_PASSWORD=password;\nSOKRATES_DATABASE_URL=jdbc:postgresql://localhost:6666/edc;\nSOKRATES_DATABASE_USER=user;\nSOKRATES_IDS_URL=http://sokrates-controlplane:8084/api/v1/ids;\nSOKRATES_AWS_SECRET_ACCESS_KEY=sokratesqwerty123;\nSOKRATES_AWS_ACCESS_KEY_ID=sokratesqwerty123;\nEDC_AWS_ENDPOINT_OVERRIDE=http://localhost:32000\n")),(0,a.kt)("p",null,"The services are using NodePort to expose the endpoints therefore the ports are not fix and needs to be determined after each deployment.\nTo determine the current ports you can use the following kubectl command:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},'kubectl get svc -n business-tests -o go-template=\'{{range .items}}{{ $save := . }}{{range.spec.ports}}{{if .nodePort}}{{$save.metadata.namespace}}{{"/"}}{{$save.metadata.name}}{{" - "}}{{.name}}{{": "}}{{.nodePort}}{{"("}}{{.port}}{{")"}}{{"\\n"}}{{end}}{{end}}{{end}}\'\n')),(0,a.kt)("p",null,'This will return all NodePorts which are available in business-tests namespace where you can pick the ports to use in your environment variables.\nNow you are able to run it in IDE either as normal "Run" mode or in "Debug" mode where you can debug the business-tests by setting debugging points.'),(0,a.kt)("p",null,"Example of mapping to environment variables needed for the business tests:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"business-tests/plato-controlplane - data: 30955(8081)    -> PLATO_DATA_MANAGEMENT_URL=http://localhost:30955/data;\nbusiness-tests/sokrates-controlplane - data: 30538(8081) -> SOKRATES_DATA_MANAGEMENT_URL=http://localhost:30538/data;\nbusiness-tests/backend - backend: 30556(8081)            -> SOKRATES_BACKEND_SERVICE_BACKEND_API_URL= http://localhost:30556\n")),(0,a.kt)("h2",{id:"6-update-your-components"},"6. Update your components"),(0,a.kt)("p",null,"Once everything is installed you just need to update your services when you have a new image."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"helm upgrade plato charts/tractusx-connector --recreate-pods\nhelm upgrade sokrates charts/tractusx-connector --recreate-pods\n")),(0,a.kt)("h2",{id:"7-tips"},"7. Tips"),(0,a.kt)("p",null,"If you use the kubernetes within Docker Desktop you have direct access to the images which you have created with Docker Desktop they are using the same docker daemon. So you don't need to transfer it in your k8s cluster."))}u.isMDXComponent=!0},34522:(e,t,s)=>{s.d(t,{Z:()=>n});const n=s.p+"assets/images/run-config-19468e50be44b114d356667f0ddcc565.png"}}]);